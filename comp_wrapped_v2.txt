-- wrapped comp esp
local plr = game.Players.LocalPlayer
local pcs = {}

local function makeESP(screen)
    local label = Drawing.new("Text")
    label.Size = 16
    label.Center = true
    label.Outline = true
    label.Visible = false
    label.Color = Color3.fromRGB(0, 255, 255)
    label.Font = 2
    
    local distLabel = Drawing.new("Text")
    distLabel.Size = 14
    distLabel.Center = true
    distLabel.Outline = true
    distLabel.Visible = false
    distLabel.Color = Color3.fromRGB(255, 255, 255)
    distLabel.Font = 2
    
    pcs[screen] = {label = label, distLabel = distLabel}
end

local function cleanup()
    for screen, esp in pairs(pcs) do
        pcall(function() esp.label:Remove() end)
        pcall(function() esp.distLabel:Remove() end)
    end
    pcs = {}
    print("comp esp cleaned up")
end

local function updateESP()
    if not _G.lunar_esps.comp.on then cleanup() return end
    
    local char = plr.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    
    for screen, esp in pairs(pcs) do
        if screen and screen.Parent then
            local pos = screen.Position + Vector3.new(0, 3, 0)
            local screenPos, onScreen = WorldToScreen(pos)
            
            if onScreen then
                esp.label.Text = "Computer"
                esp.label.Position = Vector2.new(screenPos.X, screenPos.Y - 10)
                esp.label.Visible = true
                
                if root then
                    local dx = root.Position.X - screen.Position.X
                    local dy = root.Position.Y - screen.Position.Y
                    local dz = root.Position.Z - screen.Position.Z
                    local dist = math.sqrt(dx*dx + dy*dy + dz*dz)
                    esp.distLabel.Text = math.floor(dist) .. "m"
                    esp.distLabel.Position = Vector2.new(screenPos.X, screenPos.Y + 10)
                    esp.distLabel.Visible = true
                else
                    esp.distLabel.Visible = false
                end
            else
                esp.label.Visible = false
                esp.distLabel.Visible = false
            end
        else
            pcall(function() esp.label:Remove() end)
            pcall(function() esp.distLabel:Remove() end)
            pcs[screen] = nil
        end
    end
end

local function scanForComputers()
    if not _G.lunar_esps.comp.on then return 0 end
    
    local map = workspace:FindFirstChild("Map")
    if not map then return 0 end
    
    local newFound = 0
    for _, thing in ipairs(map:GetDescendants()) do
        if thing:IsA("Model") and thing.Name == "ComputerTable" then
            local screen = thing:FindFirstChild("Screen")
            if screen and (screen:IsA("BasePart") or screen:IsA("UnionOperation")) then
                if not pcs[screen] then
                    makeESP(screen)
                    newFound = newFound + 1
                end
            end
        end
    end
    return newFound
end

wait(2)
print("initialising computer esp")
scanForComputers()

spawn(function()
    while _G.lunar_esps.comp.on do
        wait(math.random(15, 20))
        if _G.lunar_esps.comp.on then
            scanForComputers()
        end
    end
    cleanup()
end)

while _G.lunar_esps.comp.on do
    if isrbxactive() then
        updateESP()
    end
    wait(0.01)
end
cleanup()
